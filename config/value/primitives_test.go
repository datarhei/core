package value

import (
	"testing"

	"github.com/stretchr/testify/require"
)

func TestStringValue(t *testing.T) {
	var x string

	val := NewString(&x, "foobar")

	require.Equal(t, "foobar", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	x = "foobaz"

	require.Equal(t, "foobaz", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	val.Set("fooboz")

	require.Equal(t, "fooboz", x)
}

func TestStringListValue(t *testing.T) {
	var x []string

	val := NewStringList(&x, []string{"foobar"}, " ")

	require.Equal(t, "foobar", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	x = []string{"foobar", "foobaz"}

	require.Equal(t, "foobar foobaz", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	val.Set("fooboz foobar")

	require.Equal(t, []string{"fooboz", "foobar"}, x)
}

func TestStringMapStringValue(t *testing.T) {
	var x map[string]string

	val := NewStringMapString(&x, map[string]string{"a": "foobar"})

	require.Equal(t, "a:foobar", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	x = map[string]string{"a": "foobar", "b": "foobaz"}

	require.Equal(t, "a:foobar b:foobaz", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	val.Set("x:fooboz y:foobar")

	require.Equal(t, map[string]string{"x": "fooboz", "y": "foobar"}, x)
}

func TestBoolValue(t *testing.T) {
	var x bool

	val := NewBool(&x, false)

	require.Equal(t, "false", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, true, val.IsEmpty())

	x = true

	require.Equal(t, "true", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	val.Set("false")

	require.Equal(t, false, x)
}

func TestIntValue(t *testing.T) {
	var x int

	val := NewInt(&x, 11)

	require.Equal(t, "11", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	x = 42

	require.Equal(t, "42", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	val.Set("77")

	require.Equal(t, int(77), x)
}

func TestInt64Value(t *testing.T) {
	var x int64

	val := NewInt64(&x, 11)

	require.Equal(t, "11", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	x = 42

	require.Equal(t, "42", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	val.Set("77")

	require.Equal(t, int64(77), x)
}

func TestUint64Value(t *testing.T) {
	var x uint64

	val := NewUint64(&x, 11)

	require.Equal(t, "11", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	x = 42

	require.Equal(t, "42", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	val.Set("77")

	require.Equal(t, uint64(77), x)
}

func TestFloat64Value(t *testing.T) {
	var x float64

	val := NewFloat(&x, 11.1)

	require.Equal(t, "11.1", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	x = 42.5

	require.Equal(t, "42.5", val.String())
	require.Equal(t, nil, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	val.Set("77.7")

	require.Equal(t, float64(77.7), x)
}

func TestFloat64RangeValue(t *testing.T) {
	var x float64

	val := NewFloatRange(&x, 11.1, 0, 100)

	require.Equal(t, "11.100", val.String())
	require.NoError(t, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	x = 42.5

	require.Equal(t, "42.500", val.String())
	require.NoError(t, val.Validate())
	require.Equal(t, false, val.IsEmpty())

	val.Set("77.7")

	require.Equal(t, float64(77.7), x)

	val.Set("101.9")

	require.Equal(t, "101.900", val.String())
	require.Error(t, val.Validate())
	require.Equal(t, false, val.IsEmpty())
}
